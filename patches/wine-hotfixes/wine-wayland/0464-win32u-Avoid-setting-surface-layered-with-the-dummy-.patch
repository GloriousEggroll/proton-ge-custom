From bfda858b84d4debcefc1f0e2cf49fdd9e47a842d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Wed, 10 Dec 2025 10:31:41 +0100
Subject: [PATCH 464/486] win32u: Avoid setting surface layered with the dummy
 surface.

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=58914
---
 dlls/win32u/window.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dlls/win32u/window.c b/dlls/win32u/window.c
index 90c1761787d..e1bb3e61b9c 100644
--- a/dlls/win32u/window.c
+++ b/dlls/win32u/window.c
@@ -2057,7 +2057,7 @@ static struct window_surface *get_window_surface( HWND hwnd, UINT swp_flags, BOO
         window_surface_add_ref( (new_surface = &dummy_surface) );
     }
 
-    if (new_surface && !is_layered)
+    if (new_surface && new_surface != &dummy_surface && !is_layered)
     {
         DWORD lwa_flags = 0, alpha_bits = -1;
         COLORREF key;
-- 
2.53.0

